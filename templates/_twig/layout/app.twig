<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Article List</title>
        <link rel="stylesheet" href="public/css/article-list.css" type="text/css"/>
    </head>
    <body>

        <script>
            /*
                We register global simple onReady function (you might not need jquery...)
             */
            function ds__onReady (bootstrap) {
                if (document.readyState != 'loading'){
                    bootstrap();
                } else {
                    document.addEventListener('DOMContentLoaded', bootstrap);
                }
            }

            /*
                Event binding Helpers
             */
            function ds__bindEvent_querySelectorAll(querySelector, eventName, listener) {
                const items = document.querySelectorAll(querySelector);
                if (items) {
                    items.forEach((item) => {
                        item.addEventListener(eventName, listener)
                    })
                } else {
                    console.debug(`${querySelector} not found [app:__bindEventSelectorAll]`)
                }
            }

            function ds__bindEvent_getElementById(id, eventName, listener) {
                const item = document.getElementById(id);
                if (item) {
                    item.addEventListener(eventName, listener)
                } else {
                    console.debug(`${id} not found [app:__bindEvent_getElementById]`)
                }
            }

            /*
                Request Helpers
             */
            function ds__ajax_getHTML(url) {
                return new Promise((resolve, reject) => {
                    const request = new XMLHttpRequest();
                    request.open('GET', url, true);

                    request.onload = () => {
                        if (this.status >= 200 && this.status < 400) {
                            resolve(this.response);
                        } else {
                            reject(this.response);
                        }
                    };

                    request.onerror = function(error) {
                        reject('connection error');
                    };

                    request.send();
                })
            }
        </script>

        <div id="mainContainer">
            <div class="articleListTitle">
                {% block sections %}
                {% endblock %}
            </div>

            <div class="articleLinks-container" id="id__container">
                {% block container %}
                {% endblock %}
            </div>

        </div>
        {% block scripts %}
            <script>
                ds__onReady(() => {
                    console.debug('[app:ready]');

                    ds__bindEvent_getElementById('id__article_search', 'keypress', (event) => {
                        if (event.key !== 'Enter') return false;
                        const article_id = event.target.value;
                        console.debug(`search article_id=${article_id} [app:keypress]`);
                        // window.location.replace(`search?article_id=${article_id}`);
                    })
                });
            </script>
        {% endblock %}
    </body>
</html>
